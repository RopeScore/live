service cloud.firestore {
  match /databases/{database}/documents {
    match /live/federations/{federation} {
      function isAdmin() {
        return get(/databases/$(database)/documents/live/federations/$(federation)/config).data.admins[request.auth.uid] == true
      }
      match /categories/{document=**} {
        allow read;
        allow write: if isAdmin();
      }
      match /config {
        allow read, write: if isAdmin() && request.resource.data.apikey == resource.data.apikey;
      }
    }
  }
}
